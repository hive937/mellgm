<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Runner</title>
<style>
  html,body { height:100%; margin:0; background:#f0f0f0; font-family: Arial, sans-serif; }
  #game { display:block; margin:0 auto; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
  .info { text-align:center; margin:8px 0; }
  button { padding:8px 12px; font-size:14px; }
</style>
</head>
<body>
  <div class="info">
    <span>Нажми пробел или тапни по canvas, чтобы прыгнуть.</span>
    <button id="restart" style="display:none;">Перезапустить</button>
  </div>
  <canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

function resize() {
  // подгоняем размер под окно — можно менять базовую высоту
  canvas.width = Math.min(1000, window.innerWidth - 20);
  canvas.height = Math.min(400, Math.max(240, Math.floor(window.innerHeight * 0.45)));
}
window.addEventListener('resize', resize);
resize();

// Игровые переменные
let player = { x: 50, y: 0, size: 50, vy: 0, jumpPower: -14, onGround: false };
let groundY = canvas.height - 60;
let gravity = 0.8;
let obstacles = [];
let score = 0;
let gameOver = false;
let speed = 6;
let spawnTimer = 0;

player.y = groundY - player.size;

function spawnObstacle() {
  const h = 30 + Math.random() * 50;
  obstacles.push({ x: canvas.width + 10, y: groundY - h, w: 20 + Math.random()*20, h });
}

function jump() {
  if (player.onGround && !gameOver) {
    player.vy = player.jumpPower;
    player.onGround = false;
  }
}

document.addEventListener('keydown', e => {
  if (e.code === 'Space') {
    e.preventDefault();
    if (!gameOver) jump();
  }
  if (e.code === 'Enter' && gameOver) restart();
});
canvas.addEventListener('touchstart', e => { e.preventDefault(); jump(); }, {passive:false});
canvas.addEventListener('mousedown', e => jump());

function update() {
  if (gameOver) return;

  // физика игрока
  player.vy += gravity;
  player.y += player.vy;
  if (player.y + player.size >= groundY) {
    player.y = groundY - player.size;
    player.vy = 0;
    player.onGround = true;
  }

  // препятствия
  obstacles.forEach(o => o.x -= speed);
  spawnTimer--;
  if (spawnTimer <= 0) {
    spawnTimer = 60 + Math.floor(Math.random()*80); // время до следующего спавна
    spawnObstacle();
  }
  obstacles = obstacles.filter(o => o.x + o.w > -50);

  // столкновения (AABB)
  for (let o of obstacles) {
    if (player.x < o.x + o.w &&
        player.x + player.size > o.x &&
        player.y + player.size > o.y) {
      gameOver = true;
      document.getElementById('restart').style.display = 'inline-block';
    }
  }

  // прогресс/сложность
  score++;
  if (score % 1000 === 0) speed += 0.5;
}

function draw() {
  // фон
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#dff0ff';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // земля
  ctx.fillStyle = '#cfcfcf';
  ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

  // игрок
  ctx.fillStyle = '#111';
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // препятствия
  ctx.fillStyle = '#b84';
  obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.w, o.h));

  // очки
  ctx.fillStyle = '#000';
  ctx.font = '18px Arial';
  ctx.fillText('Score: ' + Math.floor(score/10), 12, 28);

  if (gameOver) {
    ctx.font = '36px Arial';
    ctx.fillText('GAME OVER', canvas.width/2 - 110, canvas.height/2);
    ctx.font = '16px Arial';
    ctx.fillText('Нажми кнопку "Перезапустить" или Enter', canvas.width/2 - 150, canvas.height/2 + 30);
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();

function restart() {
  obstacles = [];
  score = 0;
  speed = 6;
  spawnTimer = 60;
  gameOver = false;
  player.y = groundY - player.size;
  player.vy = 0;
  player.onGround = true;
  document.getElementById('restart').style.display = 'none';
}
document.getElementById('restart').addEventListener('click', restart);
</script>
</body>
</html>