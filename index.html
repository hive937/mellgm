<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Runner</title>
<style>
  html,body {
    height:100%;
    margin:0;
    background:#f0f0f0;
    font-family: Arial, sans-serif;
  }
  #game {
    display:block;
    margin:0 auto;
    background:#fff;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
  }
  .info {
    text-align:center;
    margin:8px 0;
  }
  button {
    padding:8px 12px;
    font-size:14px;
    cursor:pointer;
  }
</style>
</head>
<body>
  <div class="info">
    <span>–ù–∞–∂–º–∏ –ø—Ä–æ–±–µ–ª –∏–ª–∏ —Ç–∞–ø–Ω–∏ –ø–æ canvas, —á—Ç–æ–±—ã –ø—Ä—ã–≥–Ω—É—Ç—å –∏ –ø–æ–π–º–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã.</span>
    <button id="restart" style="display:none;">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
  </div>
  <canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

function resize() {
  canvas.width = Math.min(1000, window.innerWidth - 20);
  canvas.height = Math.min(400, Math.max(240, Math.floor(window.innerHeight * 0.45)));
}
window.addEventListener('resize', resize);
resize();

// --- –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ---
const playerImg = new Image();
playerImg.src = 'player.png'; // üëà

// –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let player = { x: 50, y: 0, size: 60, vy: 0, jumpPower: -14, onGround: false };
let groundY = canvas.height - 60;
let gravity = 0.8;
let obstacles = [];
let items = [];
let score = 0;
let gameOver = false;
let speed = 6;
let spawnTimer = 0;
let itemTimer = 0;

const jumpHeight = (player.jumpPower ** 2) / (2 * gravity);
player.y = groundY - player.size;

// --- —Ñ—É–Ω–∫—Ü–∏–∏ ---
function spawnObstacle() {
  const h = 30 + Math.random() * 50;
  obstacles.push({ x: canvas.width + 10, y: groundY - h, w: 20 + Math.random()*20, h });
}

function spawnItem() {
  const size = 20;
  const minHeightAboveGround = 40;
  const maxHeightAboveGround = Math.max(60, jumpHeight - 20);
  const y = groundY - (minHeightAboveGround + Math.random() * (maxHeightAboveGround - minHeightAboveGround));
  items.push({ x: canvas.width + 10, y, size, caught: false });
}

function jump() {
  if (player.onGround && !gameOver) {
    player.vy = player.jumpPower;
    player.onGround = false;
  }
}

// --- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ---
document.addEventListener('keydown', e => {
  if (e.code === 'Space') {
    e.preventDefault();
    if (!gameOver) jump();
  }
  if (e.code === 'Enter' && gameOver) restart();
});
canvas.addEventListener('touchstart', e => { e.preventDefault(); jump(); }, {passive:false});
canvas.addEventListener('mousedown', e => jump());

// --- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è ---
function update() {
  if (gameOver) return;

  player.vy += gravity;
  player.y += player.vy;
  if (player.y + player.size >= groundY) {
    player.y = groundY - player.size;
    player.vy = 0;
    player.onGround = true;
  }

  obstacles.forEach(o => o.x -= speed);
  spawnTimer--;
  if (spawnTimer <= 0) {
    spawnTimer = 60 + Math.floor(Math.random()*80);
    spawnObstacle();
  }
  obstacles = obstacles.filter(o => o.x + o.w > -50);

  items.forEach(i => i.x -= speed);
  itemTimer--;
  if (itemTimer <= 0) {
    itemTimer = 120 + Math.floor(Math.random() * 180);
    spawnItem();
  }
  items = items.filter(i => i.x + i.size > -50 && !i.caught);

  for (let o of obstacles) {
    if (player.x < o.x + o.w &&
        player.x + player.size > o.x &&
        player.y + player.size > o.y) {
      gameOver = true;
      document.getElementById('restart').style.display = 'inline-block';
    }
  }

  for (let i of items) {
    if (!i.caught &&
        player.x < i.x + i.size &&
        player.x + player.size > i.x &&
        player.y < i.y + i.size &&
        player.y + player.size > i.y) {
      i.caught = true;
      score += 100;
    }
  }

  score++;
  if (score % 1000 === 0) speed += 0.5;
}

// --- –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ ---
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#dff0ff';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = '#cfcfcf';
  ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

  // --- üßç‚Äç‚ôÇÔ∏è –∏–≥—Ä–æ–∫ —Ç–µ–ø–µ—Ä—å —Ä–∏—Å—É–µ—Ç—Å—è –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ---
  if (playerImg.complete) {
    ctx.drawImage(playerImg, player.x, player.y, player.size, player.size);
  } else {
    // —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç, –ø–æ–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
    ctx.fillStyle = '#111';
    ctx.fillRect(player.x, player.y, player.size, player.size);
  }

  // –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
  ctx.fillStyle = '#b84';
  obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.w, o.h));

  // üíé –ø—Ä–µ–¥–º–µ—Ç—ã
  ctx.fillStyle = '#ff0';
  items.forEach(i => {
    ctx.beginPath();
    ctx.arc(i.x + i.size/2, i.y + i.size/2, i.size/2, 0, Math.PI*2);
    ctx.fill();
  });

  ctx.fillStyle = '#000';
  ctx.font = '18px Arial';
  ctx.fillText('Score: ' + Math.floor(score/10), 12, 28);

  if (gameOver) {
    ctx.font = '36px Arial';
    ctx.fillText('GAME OVER', canvas.width/2 - 110, canvas.height/2);
    ctx.font = '16px Arial';
    ctx.fillText('–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å" –∏–ª–∏ Enter', canvas.width/2 - 150, canvas.height/2 + 30);
  }
}

// --- –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª ---
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();

// --- —Ä–µ—Å—Ç–∞—Ä—Ç ---
function restart() {
  obstacles = [];
  items = [];
  score = 0;
  speed = 6;
  spawnTimer = 60;
  itemTimer = 120;
  gameOver = false;
  player.y = groundY - player.size;
  player.vy = 0;
  player.onGround = true;
  document.getElementById('restart').style.display = 'none';
}
document.getElementById('restart').addEventListener('click', restart);
</script>
</body>
</html>
