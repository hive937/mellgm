<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

function resize() {
  canvas.width = Math.min(1000, window.innerWidth - 20);
  canvas.height = Math.min(400, Math.max(240, Math.floor(window.innerHeight * 0.45)));
}
window.addEventListener('resize', resize);
resize();

// –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let player = { x: 50, y: 0, size: 50, vy: 0, jumpPower: -14, onGround: false };
let groundY = canvas.height - 60;
let gravity = 0.8;
let obstacles = [];
let items = []; // üíé –Ω–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
let score = 0;
let gameOver = false;
let speed = 6;
let spawnTimer = 0;
let itemTimer = 0;

player.y = groundY - player.size;

function spawnObstacle() {
  const h = 30 + Math.random() * 50;
  obstacles.push({ x: canvas.width + 10, y: groundY - h, w: 20 + Math.random()*20, h });
}

// üíé —Å–æ–∑–¥–∞—ë–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç
function spawnItem() {
  const size = 20;
  const y = groundY - 100 - Math.random() * 100; // —Å–ª—É—á–∞–π–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –Ω–∞–¥ –∑–µ–º–ª—ë–π
  items.push({ x: canvas.width + 10, y, size, caught: false });
}

function jump() {
  if (player.onGround && !gameOver) {
    player.vy = player.jumpPower;
    player.onGround = false;
  }
}

document.addEventListener('keydown', e => {
  if (e.code === 'Space') {
    e.preventDefault();
    if (!gameOver) jump();
  }
  if (e.code === 'Enter' && gameOver) restart();
});
canvas.addEventListener('touchstart', e => { e.preventDefault(); jump(); }, {passive:false});
canvas.addEventListener('mousedown', e => jump());

function update() {
  if (gameOver) return;

  // —Ñ–∏–∑–∏–∫–∞ –∏–≥—Ä–æ–∫–∞
  player.vy += gravity;
  player.y += player.vy;
  if (player.y + player.size >= groundY) {
    player.y = groundY - player.size;
    player.vy = 0;
    player.onGround = true;
  }

  // –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
  obstacles.forEach(o => o.x -= speed);
  spawnTimer--;
  if (spawnTimer <= 0) {
    spawnTimer = 60 + Math.floor(Math.random()*80);
    spawnObstacle();
  }
  obstacles = obstacles.filter(o => o.x + o.w > -50);

  // üíé –ø—Ä–µ–¥–º–µ—Ç—ã
  items.forEach(i => i.x -= speed);
  itemTimer--;
  if (itemTimer <= 0) {
    itemTimer = 120 + Math.floor(Math.random() * 180); // —Å–ø–∞–≤–Ω –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Ä–µ–∂–µ
    spawnItem();
  }
  items = items.filter(i => i.x + i.size > -50 && !i.caught);

  // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
  for (let o of obstacles) {
    if (player.x < o.x + o.w &&
        player.x + player.size > o.x &&
        player.y + player.size > o.y) {
      gameOver = true;
      document.getElementById('restart').style.display = 'inline-block';
    }
  }

  // üíé –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤
  for (let i of items) {
    if (!i.caught &&
        player.x < i.x + i.size &&
        player.x + player.size > i.x &&
        player.y < i.y + i.size &&
        player.y + player.size > i.y) {
      i.caught = true;
      score += 100; // +10 –æ—á–∫–æ–≤ (–ø–æ–º–Ω–∏–º, —Å—á—ë—Ç –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 10 –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏)
    }
  }

  // –ø—Ä–æ–≥—Ä–µ—Å—Å
  score++;
  if (score % 1000 === 0) speed += 0.5;
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#dff0ff';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // –∑–µ–º–ª—è
  ctx.fillStyle = '#cfcfcf';
  ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

  // –∏–≥—Ä–æ–∫
  ctx.fillStyle = '#111';
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
  ctx.fillStyle = '#b84';
  obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.w, o.h));

  // üíé –ø—Ä–µ–¥–º–µ—Ç—ã
  ctx.fillStyle = '#ff0';
  items.forEach(i => ctx.beginPath(), ctx.arc(i.x + i.size/2, i.y + i.size/2, i.size/2, 0, Math.PI*2), ctx.fill());

  // –æ—á–∫–∏
  ctx.fillStyle = '#000';
  ctx.font = '18px Arial';
  ctx.fillText('Score: ' + Math.floor(score/10), 12, 28);

  if (gameOver) {
    ctx.font = '36px Arial';
    ctx.fillText('GAME OVER', canvas.width/2 - 110, canvas.height/2);
    ctx.font = '16px Arial';
    ctx.fillText('–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å" –∏–ª–∏ Enter', canvas.width/2 - 150, canvas.height/2 + 30);
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();

function restart() {
  obstacles = [];
  items = [];
  score = 0;
  speed = 6;
  spawnTimer = 60;
  itemTimer = 120;
  gameOver = false;
  player.y = groundY - player.size;
  player.vy = 0;
  player.onGround = true;
  document.getElementById('restart').style.display = 'none';
}
document.getElementById('restart').addEventListener('click', restart);
</script>
